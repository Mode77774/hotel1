(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0367d45c"],{"00b0":function(t,e,a){},"0499":function(t,e,a){t.exports=a.p+"static/img/newCard1.4a93859a.svg"},"223c":function(t,e,a){},2448:function(t,e,a){t.exports=a.p+"static/img/deleteIcon.4b0fa7c4.svg"},"61cf":function(t,e,a){t.exports=a.p+"static/img/cardError.c4ea36d6.svg"},8028:function(t,e,a){"use strict";var r=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"internationalCardPay_box"}},[e("div",{ref:"box_ref",attrs:{id:"internationalCardPay"},on:{scroll:t.handleScroll}},[e("p",{staticClass:"internationalCardPay_box_title"},[t._v(" "+t._s(t.$t("buyForm_components.formTitle"))+" ")]),e("div",{ref:"form_ref",staticClass:"view-content"},[e("div",{staticClass:"formLine formLine_flex"},[e("div",{staticClass:"formLine_flex_child"},[e("div",{staticClass:"formContent",class:{formContentError:t.errorFirstname,formContentFocus:t.focusFirstname},attrs:{id:"firstname"}},[e("div",{staticClass:"formTitle"},[t._v(" "+t._s(t.$t("buyForm_components.firstName"))+" ")]),e("van-field",{staticClass:"number_input input-box",attrs:{formatter:t.formatter,maxlength:"50",placeholder:"Martin"},on:{input:function(e){return t.nameChange("first","input")},focus:function(e){return t.inputFocus("firstname")},blur:function(e){return t.inputBlur("firstname")}},model:{value:t.params.firstname,callback:function(e){t.$set(t.params,"firstname",e)},expression:"params.firstname"}})],1),e("el-collapse-transition",[t.errorFirstname?e("div",{staticClass:"errorTips"},[t._v(" "+t._s(t.$t("buyForm_components.nameTips"))+" ")]):t._e()])],1),e("div",{staticClass:"formLine_flex_child"},[e("div",{staticClass:"formContent",class:{formContentError:t.errorLastname,formContentFocus:t.focusLastname},attrs:{id:"lastname"}},[e("div",{staticClass:"formTitle"},[t._v(" "+t._s(t.$t("buyForm_components.lastName"))+" ")]),e("van-field",{staticClass:"number_input input-box",attrs:{formatter:t.formatter,maxlength:"50",placeholder:"Christina"},on:{input:function(e){return t.nameChange("last","input")},focus:function(e){return t.inputFocus("lastname")},blur:function(e){return t.inputBlur("lastname")}},model:{value:t.params.lastname,callback:function(e){t.$set(t.params,"lastname",e)},expression:"params.lastname"}})],1),e("el-collapse-transition",[t.errorLastname?e("div",{staticClass:"errorTips"},[t._v(" "+t._s(t.$t("buyForm_components.nameTips"))+" ")]):t._e()])],1)]),e("div",{staticClass:"formLine"},[e("div",{staticClass:"formContent",class:{formContentError:t.errorCard,formContentFocus:t.focusCard},attrs:{id:"cardNumber"}},[e("div",{staticClass:"formTitle"},[t._v(" "+t._s(t.$t("buyForm_components.cardNumber"))+" ")]),e("van-field",{staticClass:"number_input input-box",attrs:{type:"digit",maxlength:"23",placeholder:"1234 1234 1234 1234","right-icon":t.cardLogo},on:{input:t.cardChange,focus:function(e){return t.inputFocus("cardNumber")},blur:function(e){return t.inputBlur("cardNumber")}},model:{value:t.params.cardNumber,callback:function(e){t.$set(t.params,"cardNumber",e)},expression:"params.cardNumber"}})],1),e("el-collapse-transition",[t.errorCard?e("div",{staticClass:"errorTips cardNumberError"},[t._v(" "+t._s(t.$t("buyForm_components.cardNumTips"))+" ")]):t._e()])],1),e("div",{staticClass:"formLine formLine_flex"},[e("div",{staticClass:"formLine_flex_child"},[e("div",{staticClass:"formContent",class:{formContentError:t.errorTime,formContentFocus:t.focusTime},attrs:{id:"timeData"}},[e("div",{staticClass:"formTitle"},[t._v(" "+t._s(t.$t("buyForm_components.expirationDate"))+" ")]),e("div",{staticClass:"input-box"},[e("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.timeData,expression:"timeData",modifiers:{trim:!0}}],staticClass:"dataName",attrs:{type:"text",maxlength:"7",placeholder:"MM/YY"},domProps:{value:t.timeData},on:{input:[function(e){e.target.composing||(t.timeData=e.target.value.trim())},t.timeChange],blur:[function(e){return t.inputBlur("timeData")},function(e){return t.$forceUpdate()}],focus:function(e){return t.inputFocus("timeData")},paste:t.onPaste}})])]),e("el-collapse-transition",[t.errorTime?e("div",{staticClass:"errorTips"},[t._v(" "+t._s(t.$t("buyForm_components.dataTips"))+" ")]):t._e()])],1),e("div",{staticClass:"formLine_flex_child"},[e("div",{staticClass:"formContent",class:{formContentError:t.errorCvv,formContentFocus:t.focusCvv},attrs:{id:"cardCvv"}},[e("div",{staticClass:"formTitle"},[t._v(t._s(t.$t("buyForm_components.cvv")))]),e("van-field",{staticClass:"number_input input-box",attrs:{type:"digit",maxlength:"3",placeholder:"123"},on:{input:function(e){return t.cvvChange("input")},focus:function(e){return t.inputFocus("cardCvv")},blur:function(e){return t.inputBlur("cardCvv")},paste:t.onPaste},model:{value:t.params.cardCvv,callback:function(e){t.$set(t.params,"cardCvv",e)},expression:"params.cardCvv"}})],1),e("el-collapse-transition",[t.errorCvv?e("div",{staticClass:"errorTips"},[t._v(" "+t._s(t.$t("buyForm_components.cvvTips"))+" ")]):t._e()])],1)]),e("transition",[e("div",{directives:[{name:"show",rawName:"v-show",value:t.goDown_state,expression:"goDown_state"}],staticClass:"downTips-icon",on:{click:t.goDown}},[e("img",{ref:"downTips_ref",attrs:{src:a("80b8"),alt:""}})])])],1)]),e("footer",[e("button",{directives:[{name:"show",rawName:"v-show",value:t.buttonIsShow,expression:"buttonIsShow"}],ref:"button_ref",staticClass:"continue",attrs:{disabled:t.buttonState},on:{click:t.submitPay}},[t._v(" "+t._s(t.$t("nav.Confirm"))+" "),t.request_loading?e("button-loading",{staticClass:"rightIcon"}):e("img",{staticClass:"rightIcon",attrs:{src:a("b120"),alt:""}})],1),e("powered-by")],1)])},s=[],i=(a("14d9"),a("eec8")),o=a("3591"),n=a("2f62"),c={name:"International-card-payment",props:["savedCard"],data(){return{params:{firstname:"",lastname:"",email:"",cardNumber:"",cardCvv:"",cardExpireYear:"",cardExpireMonth:"",source:0},timeData:"",oldTimeData:"",errorFirstname:!1,errorLastname:!1,errorCard:!1,errorCvv:!1,errorTime:!1,focusFirstname:!1,focusLastname:!1,focusCard:!1,focusCvv:!1,focusTime:!1,buttonIsShow:!0,request_loading:!1,goDown_state:!1,oldOffsetTop:0,timeDown:null,timeDown1:null,cardLogo:""}},computed:{...Object(n["b"])("cryptoBuyPage",{fiat:t=>t.fiatCurrencyInfo.fiat}),...Object(n["b"])("buyPayments",{userCardId:t=>t.userCardId,orderNo:t=>t.orderNo,payMethodInfo:t=>t.payMethodInfo,placeOrderQuery:t=>t.placeOrderQuery}),...Object(n["b"])("secondaryBuyPayments",{buyPayment_secondPay:t=>t.buyPayment_secondPay}),...Object(n["b"])("buyCryptoMerchant",{merchantInfo:t=>t.merchantInfo}),buttonState(){const{firstname:t,lastname:e,cardNumber:a,cardCvv:r}=this.params,s=this.timeData,i=/(.)\1\1/;let o=t.length<2||i.exec(t)||2===t.length&&t.match(new RegExp(/(\w)\1+/g)),n=e.length<2||i.exec(e)||2===e.length&&e.match(new RegExp(/(\w)\1+/g)),c=!this.$options.filters.isSupportedCardTypes(a),m=r.length<3;const l=/^(0[1-9]|1[0-2])\s{1}\/\s{1}\d{2}$/;let d;if(l.test(s)){let t=(new Date).getMonth()+1;t<10&&(t="0"+t);let e=(new Date).getFullYear()+"-"+t,a="20"+s.substring(5,7)+"-"+s.substring(0,2);Date.parse(new Date(a))<Date.parse(new Date(e))&&(d=!0)}else d=!0;return!!(o||n||c||m||d||this.request_loading)}},activated(){this.$nextTick(()=>{this.$refs.box_ref.offsetHeight+4<document.getElementById("internationalCardPay").scrollHeight-50?this.goDown_state=!0:this.goDown_state=!1}),this.clearData()},watch:{timeData(t,e){this.oldTimeData=e}},methods:{onPaste(t){t.preventDefault(),this.$toast({duration:3e3,message:this.$t("buyForm_components.paste_tips"),className:"paste_tips_toast"})},formatter(t){return t.replace(/[^a-zA-Z ]/g,"")},timeChange(t){const e=/^(0[1-9]|1[0-2])\s{1}\/\s{1}\d{2}$/,a=/^(0?[1-9]|1[0-2])$/;if(this.timeData=this.timeData.replace(/[^0-9/\s]/g,""),2==this.timeData.length&&a.test(this.timeData)&&null!==t.data&&(this.timeData+=" / "),this.timeData.trim()){if(e.test(this.timeData)){let t=(new Date).getMonth()+1;t<10&&(t="0"+t);let e=(new Date).getFullYear()+"-"+t,a="20"+this.timeData.substring(5,7)+"-"+this.timeData.substring(0,2);Date.parse(new Date(a))>=Date.parse(new Date(e))&&(this.errorTime=!1)}}else this.errorTime=!1},nameChange(t,e){let a=/(.)\1\1/;"first"===t?this.params.firstname.length<2||a.exec(this.params.firstname)||2===this.params.firstname.length&&this.params.firstname.match(new RegExp(/(\w)\1+/g))?"blur"===e&&(this.errorFirstname=!0):this.errorFirstname=!1:"last"===t&&(this.params.lastname.length<2||a.exec(this.params.lastname)||2===this.params.lastname.length&&this.params.lastname.match(new RegExp(/(\w)\1+/g))?"blur"===e&&(this.errorLastname=!0):this.errorLastname=!1),this.params.firstname.length||(this.errorFirstname=!1),this.params.lastname.length||(this.errorLastname=!1)},inputFocus(t){"firstname"===t?this.focusFirstname=!0:"lastname"===t?this.focusLastname=!0:"cardNumber"===t?this.focusCard=!0:"timeData"===t?this.focusTime=!0:"cardCvv"===t&&(this.focusCvv=!0)},timeBlur(){const t=/^(0[1-9]|1[0-2])\s{1}\/\s{1}\d{2}$/;if(this.timeData.trim())if(t.test(this.timeData)){let t=(new Date).getMonth()+1;t<10&&(t="0"+t);let e=(new Date).getFullYear()+"-"+t,a="20"+this.timeData.substring(5,7)+"-"+this.timeData.substring(0,2);Date.parse(new Date(a))>=Date.parse(new Date(e))?this.errorTime=!1:this.errorTime=!0}else this.errorTime=!0;else this.errorTime=!1},inputBlur(t){if("firstname"===t)this.focusFirstname=!1,this.nameChange("first","blur");else if("lastname"===t)this.focusLastname=!1,this.nameChange("last","blur");else if("cardNumber"===t){if(this.focusCard=!1,""!==this.params.cardNumber&&void 0!==this.params.cardNumber){this.params.cardNumber=this.params.cardNumber.replace(/\s/g,"").replace(/....(?!$)/g,"$& ");const t={payWayCode:"10001",...this.params};this.$store.commit("buyPayments/set_payMethodInfo",t);try{const t=this.$options.filters.isSupportedCardTypes(this.params.cardNumber);t?(this.errorCard=!1,this.cardLogo=this.$options.filters.getCardInfobyCardNumber(this.params.cardNumber,"cardLogo")):(this.errorCard=!0,this.cardLogo=a("61cf"))}catch(e){console.log(e)}}}else"timeData"===t?(this.focusTime=!1,this.timeBlur()):"cardCvv"===t&&(this.focusCvv=!1,this.cvvChange("blur"))},cardChange(t){if(""!==t&&void 0!==t){this.params.cardNumber=t.replace(/\s/g,"").replace(/....(?!$)/g,"$& ");const e=this.$options.filters.isSupportedCardTypes(this.params.cardNumber);e&&(this.errorCard=!1,this.cardLogo="")}else this.cardLogo="",this.errorCard=!1;this.cardLogo=this.$options.filters.getCardInfobyCardNumber(t,"cardLogo")},cvvChange(t){this.params.cardCvv.length<3?"blur"==t&&(this.errorCvv=!0):this.errorCvv=!1,this.params.cardCvv.length||(this.errorCvv=!1)},submitPay(){if(this.request_loading=!0,"tradeHistory"!==this.$route.query.pathHistry)this.saveCardInfo();else{let t={orderNo:this.buyPayment_secondPay.orderNo,payWayCode:"10001"};this.$axios.post(this.$api.post_updateOrderInfo,t,"").then(t=>{t&&this.saveCardInfo()}).catch(()=>{this.request_loading=!1})}},saveCardInfo(){let t=this,e=this.params.cardNumber.replace(/\s*/g,"");this.params.cardExpireMonth=this.timeData.substring(0,2),this.params.cardExpireYear="20"+this.timeData.substring(5,7);let a=JSON.parse(JSON.stringify(this.params));a.cardNumber=Object(i["b"])(e).replace(/ /g,""),a.cardCvv=Object(i["b"])(a.cardCvv),a.firstname=Object(i["b"])(a.firstname.trim()),a.lastname=Object(i["b"])(a.lastname.trim());const{enc_email:r}=Object(o["j"])(localStorage.getItem("email"));a.email=r,a.source=0,a.failCode&&delete a.failCode,this.$axios.post(this.$api.post_saveCardInfo,a,"").then(e=>{if(e&&e.data){if(this.$store.commit("buyPayments/set_userCardId",e.data.userCardId),this.$store.commit("buyPayments/set_fullName",Object(i["b"])(Object(i["a"])(e.data.firstName)+" "+Object(i["a"])(e.data.lastName))),a.userCardId=e.data.userCardId,t.$store.commit("buyPayments/set_creditCardInfo",a),"tradeHistory"===this.$route.query.pathHistry)return void this.$router.push("/creditCardConfig?pathHistry=tradeHistory").then(()=>{this.request_loading=!1});if(this.$route.query.orderNo)return void this.isKyc();t.placeOrder(a)}}).catch(()=>{this.request_loading=!1})},async placeOrder(){let t=await Object(o["r"])();if(!0===t&&!1===this.$parent.request_loading){this.$parent.request_loading=!0;let t=this.placeOrderQuery;t.payWayCode="10001";let e="",a=sessionStorage.getItem("merchantType");this.merchantInfo&&this.merchantInfo.merchantStatus&&"buy"===a&&(e="?"+this.merchantInfo.merchantFullPath,t.merchantParam=this.merchantInfo.merchantFullPath),this.$axios.post(this.$api.post_buy+e,t,"submitToken").then(t=>{t&&t.data&&(this.$store.commit("buyPayments/set_orderNo",t.data.orderNo),this.isKyc())}).catch(()=>{this.request_loading=!1,this.$parent.request_loading=!1})}else this.request_loading=!1,this.$parent.request_loading=!1},async isKyc(){let t=await Object(o["k"])(this.orderNo);"1"===t?this.isKyc_onfido():"2"===t&&this.isKyc_sumsub()},isKyc_onfido(){let t={orderAmount:this.placeOrderQuery.amount,fiat:this.placeOrderQuery.fiatCurrency,payType:this.payMethodInfo.payWayCode,businessType:1},e=this;this.$axios.post(this.$api.post_check,t,"").then(t=>{try{if((1==t.data.kycFlag||2==t.data.kycFlag)&&2==t.data.userLevel)return localStorage.setItem("getKycTokenByOnfidoWay","true"),localStorage.setItem("kyc_info_onfido",JSON.stringify(t.data)),void this.isKyc_sumsub("kyc_onfido");localStorage.removeItem("getKycTokenByOnfidoWay")}catch(a){console.log(a)}if(t&&t.data){if(this.clearData(),1==t.data.kycFlag)return e.$store.state.WhichPage="/creditCardConfig?orderNo="+this.orderNo,void e.$router.push("/kycVerify").then(()=>{this.request_loading=!1});if(2==t.data.kycFlag)e.$store.state.WhichPage="/creditCardConfig?orderNo="+this.orderNo,e.$router.push("/kycStatus").then(()=>{this.request_loading=!1});else if(0==t.data.kycFlag){this.$parent.addNewCardShow=3,this.$parent.$refs.addNewCard.style="",this.timeDown1=setTimeout(()=>{this.$parent.$refs.addNewCard.style="transition:0;transform: translate(0,100%);"},600);let t="/creditCardConfig";this.merchantInfo.merchantStatus&&"api"===this.merchantInfo.merchantType&&(t="/creditCardConfig?orderNo="+this.orderNo),this.$router.push(t).then(()=>{this.request_loading=!1})}}}).catch(()=>{this.request_loading=!1})},isKyc_sumsub(t){let e=this;if("kyc_onfido"==t)return this.clearData(),e.$store.state.WhichPage="/creditCardConfig?orderNo="+this.orderNo,void e.$router.push("/kycVerification").then(()=>{this.request_loading=!1});this.$axios.post(this.$api.post_getKycThrough,{orderNo:this.orderNo},"").then(t=>{if(t&&t.data){if(this.clearData(),!0===t.data.isKyc&&"3"!==t.data.kycLevel)return this.$store.commit("userInfo/set_kycInfo_levelIndex",t.data.kycLevel),"1"==t.data.kycLevel||"1,2"===t.data.kycLevel||"1,2,3"===t.data.kycLevel?this.$store.commit("userInfo/set_kycInfo_kycTips",1):this.$store.commit("userInfo/set_kycInfo_kycTips",2),e.$store.state.WhichPage="/creditCardConfig?orderNo="+this.orderNo,void e.$router.push("/kycVerification").then(()=>{this.request_loading=!1});this.$parent.addNewCardShow=3,this.$parent.$refs.addNewCard.style="",this.timeDown1=setTimeout(()=>{this.$parent.$refs.addNewCard.style="transition:0;transform: translate(0,100%);"},600);let a="/creditCardConfig";this.merchantInfo.merchantStatus&&"api"===this.merchantInfo.merchantType&&(a="/creditCardConfig?orderNo="+this.orderNo),this.$router.push(a).then(()=>{this.request_loading=!1})}}).catch(()=>{this.request_loading=!1})},clearData(){this.params={firstname:"",lastname:"",email:localStorage.getItem("email"),cardNumber:"",cardCvv:"",cardExpireYear:"",cardExpireMonth:"",source:0},this.timeData="",this.errorCard=!1,this.errorCvv=!1,this.errorTime=!1,this.errorFirstname=!1,this.errorLastname=!1,this.cardLogo=""},handleScroll(t){window.clearTimeout(this.timeDown),this.timeDown=null;let e=this.$refs.button_ref.getBoundingClientRect();this.oldOffsetTop!==e.top&&t.srcElement.scrollTop+t.srcElement.offsetHeight<t.srcElement.scrollHeight-50&&(this.goDown_state=!1,window.clearTimeout(this.timeDown),this.timeDown=null,this.timeDown=setTimeout(()=>{this.goDown_state=!0},1e3)),t.srcElement.scrollTop+t.srcElement.offsetHeight>t.srcElement.scrollHeight-50&&(window.clearTimeout(this.timeDown),this.timeDown=null,this.goDown_state=!1),this.oldOffsetTop=e.top},goDown(){setTimeout(()=>{this.$refs.button_ref.scrollIntoView({behavior:"smooth",block:"end",inline:"end"}),this.goDown_state=!1})}}},m=c,l=(a("a168"),a("e2d9"),a("2877")),d=Object(l["a"])(m,r,s,!1,null,"2533a31c",null);e["a"]=d.exports},"80b8":function(t,e,a){t.exports=a.p+"static/img/downIcon.0d4aab33.svg"},9103:function(t,e,a){t.exports=a.p+"static/img/ShutDown2.fb845839.svg"},a168:function(t,e,a){"use strict";a("223c")},e2d9:function(t,e,a){"use strict";a("00b0")}}]);
//# sourceMappingURL=chunk-0367d45c.1702633336083.js.map